var R=Object.defineProperty;var h=(t,e,n)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var b=(t,e)=>{for(var n in e)R(t,n,{get:e[n],enumerable:!0})};var d=(t,e,n)=>(h(t,typeof e!="symbol"?e+"":e,n),n);var g={};b(g,{aggregate:()=>T,count:()=>U,deleteMany:()=>E,deleteOne:()=>S,distinct:()=>F,find:()=>w,findOne:()=>D,findTerms:()=>H,findTermsChildren:()=>P,insertMany:()=>A,insertOne:()=>O,replaceOne:()=>_,updateMany:()=>x,updateOne:()=>v});import{getMethod as M}from"@servicestack/client";import{getMethod as I,JsonServiceClient as y}from"@servicestack/client";var l=class{constructor(){}ValidateCM(e){if(e.apiKey===void 0||e.apiKey==="")throw new Error("CodeMash config is not valid, check CODEMASH_API_URL");if(e.apiKey===void 0||e.apiKey==="")throw Error("CodeMash config is not valid, check CODEMASH_API_KEY");if(e.projectId===void 0||e.projectId==="")throw Error("CodeMash config is not valid, check CODEMASH_PROJECT_ID")}static AssertCMConfig(e){new l().ValidateCM(e)}};var f=class{};d(f,"CODEMASH_API_URL","https://api.codemash.io");var p=class{apiUrl;apiKey;projectId;cluster;baseFilePath;region;showLogs;constructor(){this.apiUrl=process.env.CODEMASH_API_URL||f.CODEMASH_API_URL,this.apiKey=process.env.CODEMASH_API_KEY,this.projectId=process.env.CODEMASH_PROJECT_ID,this.cluster=process.env.CODEMASH_CLUSTER,this.baseFilePath=process.env.CODEMASH_BASE_FILE_PATH,this.region=process.env.CODEMASH_REGION,this.showLogs=!!process.env.CODEMASH_SHOW_LOGS}static getInstance(){return p.instance?p.instance:(this.instance=new p,this.instance)}isValid(){return typeof this.apiKey=="string"&&typeof this.cluster=="string"&&typeof this.projectId=="string"}Validate(){l.AssertCMConfig(this)}},s=p;d(s,"instance");var C=(c=>(c.Update="update",c.Filter="filter",c.Document="document",c))(C||{}),m=(e=>(e.Documents="documents",e))(m||{}),i=class extends y{constructor(e){super(e.apiUrl);this.config=e;this.config.isValid()&&(this.config.cluster&&this.headers.set("X-CM-Cluster",this.config.cluster),this.headers.set("Authorization",`Bearer ${this.config.apiKey}`),this.headers.set("X-CM-ProjectId",this.config.projectId))}dbRequest(e,n,c){return Object.values(C).forEach(a=>{let o=e[a];o&&(e[a]=typeof o!="string"?JSON.stringify(o):o)}),Object.values(m).forEach(a=>{let o=e[a];o&&(e[a]=o.map(u=>typeof u!="string"?JSON.stringify(u):u))}),s.getInstance().showLogs&&console.log(`Outgoing ${I(e)} request: `,e),this.api(e,n,c)}};var q=t=>typeof t=="string",r=t=>{let{isSuccess:e,response:n,isError:c,errorStatus:a}=t,{responseStatus:o,result:u}=n||{};return s.getInstance().showLogs&&console.log(`Result for ${M(t)} request: `,t.response),{isSuccess:e,isError:c,errorStatus:a,responseStatus:o,response:q(u)?JSON.parse(u):n}};async function w(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function D(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function O(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function A(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function S(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function E(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function v(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function x(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function _(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function T(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function U(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function F(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function H(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}async function P(t){let n=await new i(s.getInstance()).dbRequest(t);return r(n)}var ie=g;export{ie as db};
//# sourceMappingURL=index.js.map
